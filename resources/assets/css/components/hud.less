@radial_tools:
  ellipse,   159.01px,  49.71px,
  rectangle, 199.00px, 119.00px,
  line,      159.01px, 188.29px,
  pencil,     79.00px, 188.29px,
  text,       39.00px, 119.52px,
  select,     82.66px,  49.71px;
.shape_position(@array; @count: length(@array); @name_value: -2; @x_value: -1; @y_value: 0; @icon_scale: .2) when (@count > (length(@array) / 3)) {
  .shape_position(@array; (@count - 2); (@name_value - 1); (@x_value - 1); (@y_value - 1); @icon_scale);    // <-- Loop to next iteration until count is 0
  @name:     extract(@array, (@count + @name_value));                                                       //
  @x_offset: extract(@array, (@count + @x_value)) * (1 / @icon_scale);                                      //
  @y_offset: extract(@array, (@count + @y_value)) * (1 / @icon_scale);                                      //
  &.shape-@{name} {.transform(scale3d(@icon_scale, @icon_scale, 1); translate3d(@x_offset, @y_offset, 0));} // <-- Actual style to written for each array item
}
.app-hud {
  > a {
    &[role="button"] {
      .animation(in-bounce @speed_slower backwards);
      .flexy(center, center);
      .icon(stroke; @white);
      position: fixed;
      font-size: 1.5em;
      width: @tile;
      height: @tile;
      &:not(:hover) {
        [class|="icon"] {
          opacity: .5;
        }
      }
    }
  }
}
.radial-menu {
  position: fixed;
  width: @radial_menu_size;
  height: @radial_menu_size;
  z-index: @zindex_radial_menu;
}
.radial-buttons {
  width: @radial_menu_size + 2;
  height: @radial_menu_size + 2;
  margin-left: -1em;
  margin-top: -1em;
  padding: 1rem;
  overflow: visible;
}
.radial-button {
  cursor: pointer;
  transition: @speed @bezier_transform;
  &:hover {
    .transform(translate3d(-13px, -13px, 0); scale3d(1.1, 1.1, 1));
    transition-duration: @speed_fast;
    .radial-pie {
      fill: @gray_dark;
      transition-duration: @speed_fast;
    }
    .radial-icon {
      stroke: @white;
      transition-duration: @speed_fast;
    }
  }
  &:active {
    .radial-pie {
      fill: @gray_darker;
    }
  }
}
.radial-pie {
  fill: @gray_darker;
  stroke: @gray_dark;
  transition: @speed @bezier_transform;
}
.radial-icon {
  .shape_position(@radial_tools);
  fill: none;
  stroke: @gray_light;
  stroke-width: 8;
  pointer-events: none;
  transition: @speed @bezier_fadein;
}
.radial-point {
  fill: @gray_dark;
}
.radial-hint {
  .user-select(none);
  position: absolute;
  top: -@tile;
  left: -@tile;
  white-space: nowrap;
  .mq_640({
    display: none;
  });
}
.excess-toggle {
  transition: visibility @now @now @bezier_fadein;
}
.menu-toggle {
  .animation(in-fade-top @speed_slower @speed_slower @bezier_fadein backwards);
  top: 0;
  left: 0;
  transition+: -webkit-transform @speed @bezier_deform;
  transition+:         transform @speed @bezier_deform;
  &.bkg-light {
    &[role="button"] {
      .icon(stroke; @black);
    }
  }
  .icon-menu {
    transition: opacity @speed_fast @speed @bezier_fadein;
  }
  path {
    -webkit-transition-property: -webkit-transform, opacity, stroke;
    transition-property: transform, opacity, stroke;
    transition-duration: @speed_slow, @speed, @speed_fast;
    transition-timing-function: @bezier_transform, @bezier_fadein, @bezier_fadein;
  }
  &.close,
  &.back {
    .scale3d(.75);
    path {
      transition-timing-function: @bezier_bounce, @bezier_fadein, @bezier_fadein;
    }
  }
  &.close {
    path {
      &[class*="top"] {
        .transform(translate3d(32.32px, -3.03px, 0) rotate3d(0, 0, 1, 45deg));
      }
      &[class*="btm"] {
        .transform(translate3d(-38.39px, 32.32px, 0) rotate3d(0, 0, 1, -45deg));
      }
    }
    .stroke-menu-mid {
      opacity: 0;
      .transform(translate3d(-20.71px, 50px, 0) rotate3d(0, 0, 1, -45deg));
    }
  }
  &.back {
    path {
      &:not(.stroke-menu-mid) {
        &[class*="left"] {
          opacity: 0;
        }
        &[class*="right"] {
          stroke-linecap: square;
        }
      }
      &[class*="top"] {
        .transform(translate3d(-12.68px, -3.03px, 0) rotate3d(0, 0, 1, 45deg));
      }
      &[class*="btm"] {
        .transform(translate3d(-83.39px, 32.32px, 0) rotate3d(0, 0, 1, -45deg));
      }
    }
  }
}
.chat-toggle {
  .animation(in-fade-bottom @speed_slower @speed_slower @bezier_fadein backwards);
  bottom: 0;
  right: 0;
  &:hover {
    .unseen-eids {
      background: @red;
      color: @white;
      border-color: @red;
      height: 1.8em;
      min-width: 1.8em;
      padding: 2px 4px;
      bottom: 3.1em;
      right: 3.1em;
    }
  }
}
.info-toggle {
  top: @tile;
  left: 0;
}
.landing-toggle {
  top: 0;
  right: 0;
}
.mouse-stats {
  .user-select(none);
  position: absolute;
  color: @gray;
  font-family: @font_mono;
  font-size: 0.625rem;
  line-height: 1em;
  text-align: center;
  bottom: 0;
  width: 100%;
  left: 0;
  padding: .5em;
  pointer-events: none;
  transition: @speed @bezier_fadein;
  .mq_640({
    opacity: 0;
  });
}
.viewers {
  .flexy(column);
  position: fixed;
  color: @white;
  bottom: 0;
  left: 0;
  min-width: @menu_width_min;
  max-width: @menu_width_max;
  max-height: 4 * 2.5em; // first value is number visible upon opening
  padding: 1em 1.5em;
  transition+: all @speed;
  transition+: bottom @now;
  &.overflowing {
    .scrollbar(width; .25em;);
    .scrollbar_thumb(border-radius; .25em);
    overflow-y: auto;
    will-change: transform, bottom;
    &:hover {
      .scrollbar_thumb(background; fade(@black, 25));
      .viewer-self {
        .viewer-name {
          &:before {
            .translate3d(0,100%,0);
            opacity: 0;
          }
          &:after {
            .animation(in-fade-top @speed_slower @bezier_fadein);
            content: attr(data-name);
          }
        }
      }
    }
    &:not(:hover) {
      &:not(:active) {
        .user-select(none);
        .translate3d(0,100%,0);
        bottom: @tile;
        .viewer-self {
          ~ .viewer {
            .translate3d(0,100%,0);
          }
          .icon-user {
            .scale3d(1.5);
            transition: @speed @speed @bezier_deform;
          }
        }
      }
    }
    .viewer-self {
      .viewer-name {
        &:before {
          content: attr(data-count);
          transition: @speed_slower @bezier_fadein;
        }
      }
    }
  }
  &:not(.overflowing) {
    &:hover {
      .viewer-self {
        &:only-child {
          .viewer-name {
            &:after {
              .animation(in-fade-top @speed_slower @bezier_fadein);
              content: attr(data-name);
            }
          }
        }
      }
    }
    .viewer-self {
      &:only-child {
        .viewer-name {
          opacity: 1;
        }
        .icon-user {
          .scale3d(1.5);
          transition: @speed @speed @bezier_deform;
        }
      }
      &:not(:only-child) {
        .viewer-name {
          &:after {
            .animation(in-fade-top @speed_slower @bezier_fadein);
            content: attr(data-name);
          }
        }
      }
    }
  }
  // TODO deciding whether to edit name inline or not...
  // input {
  //   height: @tile;
  //   max-height: (@tile * 2);
  //   background: none;
  //   border: none;
  //   outline: 0;
  //   color: @white;
  // }
}
.viewer-self {
  .icon-user {
    .animation(viewer @speed_slower backwards);
    transition: @speed @now @bezier_deform;
    path {
      stroke: fade(@white,50);
      transition: stroke @speed_slower @bezier_fadein;
    }
  }
  .viewer-name {
    position: relative;
    min-height: 1em * @line_height;
    &:before,
    &:after {
      position: absolute;
      top: 0;
      left: 0;
      white-space: nowrap;
    }
  }
}
.viewer {
  .flexy(center);
  .transition_cascade(10);
  height: @tile / 2;
  min-height: @tile / 2;
  transition: @speed @bezier_deform;
  &:not(:hover) {
    .viewer-name {
      opacity: .25;
    }
  }
  &:not(.viewer-self) {
    .animation(in-fade-bottom @speed_slower @bezier_fadein);
  }
}
.viewer-name {
  margin-left: 1em;
  cursor: default;
}
